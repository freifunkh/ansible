---

- name: Create systemd service to add mesh-vpn-* devices into bat*
  template:
    src: addtobatX.j2
    dest: /etc/systemd/system/add-vxwg-to-batX@.service

- name: Systemd daemon-reload
  systemd:
    daemon_reload: yes

- name: Enable systemd services
  systemd:
    name: add-vxwg-to-batX@{{ item.id }}
    enabled: yes
  with_items:
    - "{{ domains }}"

- name: Restart networkd
  systemd:
    state: restarted
    name: systemd-networkd

- name: Start systemd services
  systemd:
    state: started
    name: add-vxwg-to-batX@{{ item.id }}.service
  with_items:
    - "{{ domains }}"
