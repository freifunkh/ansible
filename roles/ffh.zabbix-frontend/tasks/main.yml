---

- name: Add Zabbix Repo Key
  apt_key:
    url: "https://repo.zabbix.com/zabbix-official-repo.key"
    state: present
    keyring: /etc/apt/trusted.gpg.d/zabbix.gpg

- name: Add Zabbix Repo
  apt_repository:
    repo: "deb https://repo.zabbix.com/zabbix/{{ zabbix_server_version | default('5.0') }}/debian {{ ansible_distribution_release }} main"
    state: present
    filename: zabbix

- name: Install Zabbix Webfrontend (via apt)
  apt:
    update_cache: yes
    name: "{{ packages }}"
  vars:
    packages:
    - zabbix-frontend-php

- name: Determine current php version
  shell: "find /etc/php/ -maxdepth 1 -mindepth 1 -type d -printf '%f\n' | sort -nr | head -1"
  register: php_location
  check_mode: false

- name: "PHP Timezone setting"
  notify: Reload nginx
  lineinfile:
    dest: "/etc/php/{{ php_location.stdout | default('undef') }}/fpm/php.ini"
    regexp: "date.timezone ="
    line: "date.timezone = Europe/Berlin"

