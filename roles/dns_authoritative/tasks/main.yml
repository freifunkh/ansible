---

- name: Install nsd
  apt: name=nsd

- name: Configure nsd
  notify: Restart nsd
  template:
    src: nsd.conf.j2
    dest: /etc/nsd/nsd.conf

- name: Create zone dir
  file: path=/etc/nsd/zones state=directory

- name: generate zones
  notify: Reload zones
  template:
    src: zone.j2
    dest: /etc/nsd/zones/{{item.domain}}zone
  with_items: "{{ dns_authoritative_toplevel }}"

- name: Enable nsd
  service: name=nsd enabled=yes

