# Set the domain for dnsmasq. this is optional, but if it is set, it
# does the following things:
# 1) Allows DHCP hosts to have fully qualified domain names, as long
#     as the domain part matches this setting.
# 2) Sets the "domain" DHCP option thereby potentially setting the
#    domain of all systems configured by DHCP
# 3) Provides the domain part for "expand-hosts"
domain={{ dhcp_domain_name }}

# Only add the FQDN host name of the DHCP client
dhcp-fqdn

# Set the limit on DHCP leases, the default is 150
dhcp-lease-max=65535

# Define the file for saving the leases
dhcp-leasefile=/var/lib/dnsmasq/dnsmasq.leases

# Send extra options which are tagged as "linux" to any machine whose
# DHCP vendorclass string includes the substring "Linux"
dhcp-vendorclass=set:linux,Linux

# Enforce sending MTU options to Linux devices
dhcp-option-force=tag:linux,option:mtu,1280

# Set option 58 client renewal time (T1). Defaults to half of the
# lease time if not specified. (RFC2132)
dhcp-option=option:T1,{{ dhcp_renew_timer }}

# Set option 59 rebinding time (T2). Defaults to 7/8 of the
# lease time if not specified. (RFC2132)
dhcp-option=option:T2,{{ dhcp_rebind_timer }}

# Send an empty WPAD option to Windows clients. This may be REQUIRED for Windows 7.
dhcp-option=vendor:MSFT,252,"\n"

# Send Microsoft-specific option to tell Windows to release the DHCP lease
# when it shuts down. Note the "i" flag, to tell dnsmasq to send the
# value as a four-byte integer - that's what Microsoft wants. See
# http://technet2.microsoft.com/WindowsServer/en/library/a70f1bb7-d2d4-49f0-96d6-4b7414ecfaae1033.mspx?mfr=true
dhcp-option=vendor:MSFT,2,1i

# Do not use the client ID for identification, but use the MAC addresses only.
# This makes sure that the IP addresses are always generated from the MAC address.
# CURRENTLY UNSUPPORTED - SHOULD BE ENABLED IN THE FUTURE
#dhcp-ignore-clid

# Disables ICMP echo address checking for DHCP
#no-ping

# Set the DHCP server to authoritative mode. In this mode it will barge in
# and take over the lease for any client which broadcasts on the network,
# whether it has a record of the lease or not. This avoids long timeouts
# when a machine wakes up on a new network.
dhcp-authoritative

# Log lots of extra information about DHCP transactions
#log-dhcp

{% if legacy_dom0 == true %}
# Configuration for legacy dom0
interface=bat0
dhcp-range=tag:bat0,10.2.{{ sn }}0.2,10.2.{{ sn }}9.254,{{ dhcp_valid_leasetime }}s
dhcp-option=tag:bat0,option:router,10.2.{{ sn }}0.1
dhcp-option=tag:bat0,option:dns-server,10.2.{{ sn }}0.1
{% endif %}
{% for domain in domains | default([]) %}

# Configuration for dom{{ domain.id }}
interface=bat{{ domain.id }}
dhcp-range=tag:bat{{ domain.id }},10.{{ domain.id }}.{{ sn }}0.2,10.{{ domain.id }}.{{ sn }}8.254,{{ dhcp_valid_leasetime }}s
dhcp-option=tag:bat{{ domain.id }},option:router,10.{{ domain.id }}.{{ sn }}0.1
dhcp-option=tag:bat{{ domain.id }},option:dns-server,10.{{ domain.id }}.0.1
{% endfor %}

