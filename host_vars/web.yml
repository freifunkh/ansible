---

servername: web
fqdn: "web.ffh.zone"

networkd_configures:
- iface: eth0
  dhcp: true
  addresses:
    - 2a01:4f8:221:100c::443/64
  gateway6: 2a01:4f8:221:100c::2
  dns_server:
    - 5.1.66.255
    - '2001:678:ed0:f000::'
  static_routes:
    - gw: 2a01:4f8:221:100c::2
      dest: 2a01:4f8:221:100c::7000/120

ansible_python_interpreter: "/usr/bin/python3"

foswiki_dir: "/var/www/apps/wiki"

nginx_sites:
- domain: firmware.ffh.zone
  root: /var/www/domains/firmware.ffh.zone
  tls: true
  locations:
    - location: /
      directory_index: true
- domain: fnorden.net
  root: /var/www/domains/fnorden.net
  tls: true
  tls_redirect_to_https: true
  # Todo: Multiple domains & certs for one web
- domain: www.fnorden.net
  root: /var/www/domains/fnorden.net
  tls: true
  tls_redirect_to_https: true
- domain: hannover.freifunk.net
  root: /var/www/domains/hannover.freifunk.net/
  tls: true
  tls_redirect_to_https: true
  php: true
  locations:
    - location: /api/
      expires: -1
      alias: /var/www/apps/api/
    - location: /download/
      directory_index: true
      disable_symlinks: true
      alias: /var/www/apps/download/
    - location: /gluon-firmware-wizard/
      alias: /var/www/apps/gluon-firmware-selector/
    - location: /karte/config.json
      alias: /var/www/apps/meshviewer_configs/karte.json
    - location: /friedhof/config.json
      alias: /var/www/apps/meshviewer_configs/friedhof.json
    - location: /karte/
      alias: /var/www/apps/meshviewer/
    - location: /friedhof/
      alias: /var/www/apps/meshviewer/
    - location: /device-pictures/
      alias: /var/www/apps/device-pictures/pictures-svg/
    - location: /sshauto/
      alias: /var/www/apps/sshauto/

  custom_config: |
          #
          # General
          #
          location ~ (^/Fl(ue|ü)chtlings(wohn)?heime) {
            rewrite .* /wiki/Maschinenraum/Fluechtlingsheime;
          }

          rewrite ^/api/((graph|nodes|summary)\.json)$ https://harvester.ffh.zone/api/$1 permanent;

          #
          # Wiki related
          #
          set $foswiki_root "/var/www/apps/wiki";
          client_max_body_size 10M;   # Set to maximum attachment size, See also ATTACHFILESIZELIMIT
          location = /wiki/ {
            root $foswiki_root;
            rewrite .* /wiki/Main/WebHome;
          }
          location ~ ^/wiki/pub/(.*) {
            alias $foswiki_root/pub/$1;
            allow all;
          }
          location ~ ^/wiki/bin/ {
            root $foswiki_root;
            gzip off;
            fastcgi_pass             127.0.0.1:9000;
            fastcgi_split_path_info  ^(/wiki/bin/\w+)(.*);
            fastcgi_param            SCRIPT_FILENAME $foswiki_root/bin/$fastcgi_script_name;
            fastcgi_param            SCRIPT_NAME     $fastcgi_script_name;
            fastcgi_param            PATH_INFO       $fastcgi_path_info;
            include fastcgi_params;
          }
          location ~ (^/wiki/lib|^/wiki/data|^/wiki/locale|^/wiki/templates|^/wiki/tools|^/wiki/working) {
            root $foswiki_root;
            deny all;
          }
          if ($http_user_agent ~ ^SiteSucker|^iGetter|^larbin|^LeechGet|^RealDownload|^Teleport|^Webwhacker|^WebDevil|^Webzip|^Attache|^SiteSnagger|^WX_mail|^EmailCollector|^WhoWhere|^Roverbot|^ActiveAgent|^EmailSiphon|^CrownPeak-HttpAgent|^$) {
            rewrite .* /404.html break;
          }
          location ~ ^/wiki/(.*)$ {
            root $foswiki_root;
            rewrite ^/wiki/(.*)$ /wiki/bin/view/$1;
          }
- domain: tiles.ffh.zone
  root: /var/www/domains/tiles.ffh.zone/www
  tls: true
  tls_redirect_to_https: true
  untouchable: true

burginfo_enabled: False

git2cal:
  user: www-data
  git2cal_dir: /opt/git2cal
  calendar_git: https://github.com/freifunkh/calendar.git
  calendar_dir: /tmp/calendar
  ics_file: /var/www/apps/api/meetings.ics
  json_file: /var/www/apps/api/meetings.json

meshviewer_dir: "/var/www/apps/meshviewer"
meshviewer_devicepictures_dir: "/var/www/apps/device-pictures"
meshviewer_instances:
- name: "karte"
  site: "Freifunk Hannover"
  config_file: "/var/www/apps/meshviewer_configs/karte.json"
  data_url: "https://harvester.ffh.zone/api/"
  grafana_url: "https://stats.ffh.zone"
  maxage: 14
  deprecation_text: "Dieses Gerät ist leider veraltet und wird bald nicht mehr durch Software-Updates unterstützt - <a href='https://hannover.freifunk.net/wiki/Freifunk/AlteGeraete'>Mehr Infos</a>"
  tile_url: "https://tiles.ffh.zone/{z}/{x}/{y}.png"
  tile_attribution: "<a href='https://github.com/freifunk/meshviewer/issues' target='_blank'>Report Bug</a> | Map data &copy; <a href='http://openstreetmap.org'>OpenStreetMap</a> contributor"
- name: "friedhof"
  site: "Friedhof Hannover"
  config_file: "/var/www/apps/meshviewer_configs/friedhof.json"
  data_url: "https://harvester.ffh.zone/api/graveyard/"
  grafana_url: "https://stats.ffh.zone"
  maxage: 7300
  deprecation_text: ""
  night: true
  tile_url: "https://cartodb-basemaps-b.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png"
  tile_attribution: "Map tiles by Carto, under CC BY 3.0. Data by OpenStreetMap, under ODbL."

restic_backup_paths:
- "/etc/"
- "/var/www/"

zabbix_agent_server: "zbx-hetzner.ffh.zone"
zabbix_agent_server_active: "zbx-hetzner.ffh.zone"
